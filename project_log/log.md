# 日志记录

## 2024.2.21

今天就算是这个项目的一个开端。

以前一直都有一个想法，要写一个关于 **C++后端** 的工具库，今天就是一个起步。

按照目前的想法，本项目将分为三个部分：

* 网络库部分：这个部分将会参考陈硕大佬的 **muduo** 项目结构，分为标准库部分和网路部分，具体细节将由我
  自己学习后来填充，计划用C++17实现。
* 数据库部分：这个部分目前还没有开始，计划通过学习，自己实现一个丐版 MySQl,将会先从大体结构开始，再通过
  学习细节算法和结构，慢慢填充。
* 缓存部分：这个项目同样没有开始，计划通过学习，自己实现一个丐版 Redis,将会先从大体结构开始，再通过学习
  细节算法和结构，慢慢填充。

今天推入的文件是前几天读书时实现的，现在把它们整理起来，组成一个 Base 部分，后续会利用底层函数继续实现更多部件
完善 Base 部分，逐步取代 std。

本项目是最终成品，具体测试并没有放到项目中（在另一个项目），只是写好后重新复制这里。

## 2024.2.22

今天粗略测试了新写的 Mutex & Condition，并对项目中的 std 进行了替换。

## 2024.2.23

今天修复了 Mutex & Condition 的 Bug 并新写了 BlockQueue。

## 2024.2.26

今天新加入了 File 类。

## 2024.2.27

重构了 File 类， 并修复了 Bug， 利用预定义宏和新加入的 LogStream 扩展了 Log 的功能。

## 2024.3.4

最近学习比较忙，没有太多的时间，前几天设计了网络部分的架构，过一段时间再提交。
今天优化并新增了 Log 的功能。

## 2024.3.5

今天一口气将之前写的到现在基本完善的 Poller 和 Channel 类更新。

## 2024.3.6

今天更新了 EventLoop & RingBuffer 

## 2024.3.7

今天重新更改了架构，引入了 ChannelsManger 进行管理，并加入了 NetLink 类的大纲，利用中间类让一个链接建立多个
Channel 成为了可能，同时也让读取和写入能够自由的分开到不同的线程，同时 handle 系列方法可以让处理信息变得更方
便灵活。

## 2024.3.8

今天对 Channel 功能进行了扩展，使得外部用户函数对其的控制更加灵活。同时对其他类（ChannelsManger、Poller、
RingBuffer）的功能进行了进一步完善。

今天初步决定采用**水平触发**，固定（用户可修改）**双缓冲区**（读写分开，不需加锁但线程安全）的策略，如果缓冲区
满将不会进 行额外读取，降低了代码难度，同时 也更加合理，缺点是频繁触发带来的开销，未来可能会引入新的上层类进行管
理。

放弃采用边缘触发的原因不仅仅是降低代码复杂度，因为并发模型采用 subRector 模式，一个线程内不会有过多链接。其次，
未来将会引入大文件读取与发送的特别方法，边缘触发并没有带来优势，反而因为代码的复杂降低了性能。

## 2024.3.10

今天初步更新了 Interface 的一系列函数，目的是包装底层 API，并进行一定的错误信息原因打印处理（使用了 unlikely 宏，
减小正常情况下的调用负担）。

## 2024.3.11

今天对底层 API 做了进一步优化，将错误处理分开，并引进了 error_mark，使得 NetLink 的接口形式变得明确，用户可根据
该结构判断错误，得到原因，进行对应逻辑处理。
进一步完善了 NetLink，引入了 Socket 类，对 Channel 类进行了简化和修正。

## 2024.3.12

今天引入了 InetAddress 类，初步完成了 Socket 类的全部方法，将 NetLink 类的大部分方法进行了补全，同时对 Interface
中的方法进行了补充。

## 2024.3.13

今天进行了大的变动，主要集中在 Channel & NetLink 类中，同时引入了 Reactor 类。

Reactor 类集合了 EventLoop & ChannelsManger & Poller 类，对它们统一进行管理，隐藏了内部细节。

NetLink 类进行了大变动，主要是隐藏了操作 Channel 类的细节，Channel 类不被用户使用，而是通过 netLink 就可以
完成所有的灵活变动。
Channel 类引入了 error_type 类，提供了更细节的错误处理机会，相应的，NetLink 的 ErrorCallback 引入了 error_type
参数，用户可根据此对不同错误进行处理，通过返回值决定是否关闭。

其他类也做了相应调整与优化。

## 2024.3.15

重新构建了 NetLink 的行为，删除了 LinkData,增加了 Controller 类。

用户不再通过 NetLink 直接操作 Channel 的行为，而是通过 Controller 控制。NetLink 取代了 LinkData 继承了
std::enable_shared_from_this 同时在 Channel & Controller 中拥有其弱引用，解决了循环引用的隐患的同时，不影响
正常使用。

## 2024.3.17

今天更新了 Acceptor 类，用于主线程接受链接。
彻底放弃了一个 NetLink 多个 Channel 的想法，原因如下：

* 首先，多线程对同一个文件描述符的处理并不一定会带来优势，唯一有作用的场合可能是在读与写分开的时候，但仅仅为了这一点就提供多
  Channel 的成本太高。
* 其次，Controller 可以对 Channel 进行多线程的灵活控制再加上用户自定义的回调函数（可以在多个线程读写，不一定要在 EventLoop
  线程），
  完全可以代替多 Channel 的功能。

另：net 部分的基础大都完成，接下来再更新就是对功能的填充或者是有了新的想法（重构）。

## 2024.3.19

今天优化了 Channel 的控制逻辑，进一步提升了操作的灵活性，增加了控制的安全性。
